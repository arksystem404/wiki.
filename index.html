<!DOCTYPE html>
<html lang="en" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>wiki.</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <!-- Google Fonts for all pairings -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Alegreya+Sans:wght@400;700&family=Instrument+Serif:ital@0;1&family=Karla:wght@400;700&family=Playfair+Display:wght@700&family=Poppins:wght@400;500;600&family=Trispace:wght@700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --light-bg: #f9fafb;
            --light-text: #1f2937;
            --dark-bg: #111827;
            --dark-text: #e5e7eb;
            --accent-blue: #3b82f6;
            --accent-purple: #9333ea;
        }

        /* Use Flexbox on the body to ensure the footer is always at the bottom */
        body {
            /* Default font pairing */
            --heading-font: 'Playfair Display', serif;
            --body-font: 'Poppins', sans-serif;
            
            /* Default font size */
            --base-font-size: 1rem;
            --h1-size: 2.25rem;
            --h2-size: 1.875rem;
            --h3-size: 1.5rem;
            --h4-size: 1.25rem;

            font-family: var(--body-font);
            font-size: var(--base-font-size);
            transition: background-color 0.4s ease-in-out, color 0.4s ease-in-out;
            background-color: var(--light-bg);
            color: var(--light-text);
            display: flex; /* Make body a flex container */
            flex-direction: column; /* Stack children vertically */
            min-height: 100vh; /* Ensure the body is at least the viewport height */
        }

        /* Font family classes */
        body.font-karla-instrument {
            --heading-font: 'Instrument Serif', serif;
            --body-font: 'Karla', sans-serif;
        }

        body.font-trispace-alegreya {
            --heading-font: 'Trispace', sans-serif;
            --body-font: 'Alegreya Sans', sans-serif;
        }

        /* Font size classes */
        body.font-size-small {
            --base-font-size: 0.875rem; /* 14px */
            --h1-size: 2rem;
            --h2-size: 1.625rem;
            --h3-size: 1.375rem;
            --h4-size: 1.125rem;
        }
        body.font-size-large {
            --base-font-size: 1.125rem; /* 18px */
            --h1-size: 2.5rem;
            --h2-size: 2.125rem;
            --h3-size: 1.75rem;
            --h4-size: 1.375rem;
        }

        .dark body {
            background-color: var(--dark-bg);
            color: var(--dark-text);
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        .light ::-webkit-scrollbar-thumb {
            background-color: #d1d5db;
            border-radius: 4px;
        }

        .dark ::-webkit-scrollbar-thumb {
            background-color: #4b5563;
            border-radius: 4px;
        }

        /* Vercel-like card/container style */
        .vercel-card {
            background-color: white;
            border: 1px solid #e5e7eb;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05), 0 1px 3px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .dark .vercel-card {
            background-color: #1f2937;
            border: 1px solid #374151;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2), 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        /* Hero Typewriter effect */
        .hero-typewriter h1 {
            font-family: var(--heading-font);
            overflow: hidden;
            white-space: nowrap;
            border-right: .15em solid;
            animation: typing 1.5s steps(20, end), blink-caret .75s step-end infinite;
            border-right-color: var(--caret-color);
        }
        
        .light {
            --caret-color: var(--light-text);
        }
        .dark {
            --caret-color: var(--dark-text);
        }
        
        @keyframes typing {
            from { width: 0 }
            to { width: 100% }
        }
        @keyframes blink-caret {
            from, to { border-color: transparent }
            50% { border-color: var(--caret-color); }
        }

        /* Article content styling */
        .wiki-prose p, .wiki-prose li {
            line-height: 1.6;
            margin-bottom: 1em;
            font-size: var(--base-font-size);
        }
        .wiki-prose h1, .wiki-prose h2, .wiki-prose h3, .wiki-prose h4, .wiki-prose h5, .wiki-prose h6 {
            font-family: var(--heading-font);
            font-weight: 600;
            margin-top: 1.5em;
            margin-bottom: 0.5em;
        }
        .wiki-prose h1 { font-size: var(--h1-size); }
        .wiki-prose h2 { font-size: var(--h2-size); }
        .wiki-prose h3 { font-size: var(--h3-size); }
        .wiki-prose h4 { font-size: var(--h4-size); }

        .wiki-prose a {
            color: var(--accent-blue);
            text-decoration: none;
            border-bottom: 1px solid transparent;
            transition: border-bottom 0.2s ease-in-out;
        }
        .wiki-prose a:hover {
            border-bottom: 1px solid var(--accent-blue);
        }
        .dark .wiki-prose a {
            color: #60a5fa;
        }
        .dark .wiki-prose a:hover {
            border-bottom: 1px solid #60a5fa;
        }
        
        .wiki-prose img {
            max-width: 100%;
            height: auto;
            border-radius: 0.5rem;
        }
        .wiki-prose figure {
            margin: 1rem auto;
            text-align: center;
        }
        .wiki-prose figcaption {
            font-size: 0.875rem;
            color: #6b7280;
            margin-top: 0.5rem;
        }
        .dark .wiki-prose figcaption {
            color: #9ca3af;
        }
        
        /* Fixed Go to Top button */
        #go-to-top-button {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            padding: 0.75rem;
            border-radius: 9999px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out, transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transform: translateY(1rem);
        }

        .light #go-to-top-button {
            background-color: white;
            color: var(--light-text);
        }
        .dark #go-to-top-button {
            background-color: #1f2937;
            color: var(--dark-text);
        }
        
        #go-to-top-button.visible {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        
        /* Custom Focus Glow Effect */
        .focus-glow:focus {
            outline: none;
            animation: glow 1.5s infinite alternate;
        }

        @keyframes glow {
            from {
                box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
            }
            to {
                box-shadow: 0 0 20px rgba(59, 130, 246, 0.8);
            }
        }

        .dark .focus-glow:focus {
            animation: dark-glow 1.5s infinite alternate;
        }

        @keyframes dark-glow {
            from {
                box-shadow: 0 0 10px rgba(147, 51, 234, 0.7);
            }
            to {
                box-shadow: 0 0 20px rgba(147, 51, 234, 1);
            }
        }
    
/* --- Animated Grid Background --- */
body.light {
    background-color: var(--light-bg);
    background-image: linear-gradient(rgba(0,0,0,0.03) 1px, transparent 1px),
                      linear-gradient(90deg, rgba(0,0,0,0.03) 1px, transparent 1px);
    background-size: 40px 40px;
    animation: move-grid-light 20s linear infinite;
    background-position: var(--grid-x, 0px) var(--grid-y, 0px), var(--grid-x, 0px) var(--grid-y, 0px);
}

body.dark {
    background-color: var(--dark-bg);
    background-image: linear-gradient(rgba(255,255,255,0.05) 1px, transparent 1px),
                      linear-gradient(90deg, rgba(255,255,255,0.05) 1px, transparent 1px);
    background-size: 40px 40px;
    animation: move-grid-dark 20s linear infinite;
    background-position: var(--grid-x, 0px) var(--grid-y, 0px), var(--grid-x, 0px) var(--grid-y, 0px);
}

@keyframes move-grid-light {
    0% { background-position: 0 0, 0 0; }
    100% { background-position: 40px 40px, 40px 40px; }
}

@keyframes move-grid-dark {
    0% { background-position: 0 0, 0 0; }
    100% { background-position: 40px 40px, 40px 40px; }
}

/* --- Search Box Light Theme --- */
.light #search-input {
    background-color: #f3f4f6;
    border: 2px solid #d1d5db;
    box-shadow: 0 2px 8px 0 rgba(0,0,0,0.04);
    color: #1f2937;
}
.light #search-input:focus {
    border-color: var(--accent-blue);
    box-shadow: 0 0 0 2px rgba(59,130,246,0.15);
}
.dark #search-input {
    background-color: #23272f;
    border: 2px solid #374151;
    color: #e5e7eb;
}

/* --- Hero Text Color --- */
.light .hero-typewriter h1 {
    background: linear-gradient(90deg, #213448 30%, #547792 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}
.dark .hero-typewriter h1 {
    background: linear-gradient(90deg, #DFF5FF 30%, #67C6E3 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

/* --- Custom Cursor --- */
html, body, button, input, select, textarea, a, * {
    cursor: none !important;
}

/* Updated cursor styling to be visible on both light and dark themes */
#custom-cursor {
    position: fixed;
    top: 0;
    left: 0;
    width: 32px;
    height: 32px;
    pointer-events: none;
    z-index: 9999;
    border-radius: 50%;
    transition: transform 0.12s cubic-bezier(0.4, 0, 0.2, 1), background 0.2s, border 0.2s, box-shadow 0.2s;
    will-change: transform, background;
}

/* Styles for the light theme */
.light #custom-cursor {
    background: radial-gradient(circle at 40% 40%, rgba(96, 165, 250, 0.6) 0%, rgba(96, 165, 250, 0.4) 60%, transparent 100%);
    box-shadow: 0 0 16px 4px rgba(96, 165, 250, 0.6), 0 0 0 2px rgba(96, 165, 250, 0.4);
    border: 2px solid #ffffff; /* Use a white border for visibility on light backgrounds */
}

/* Styles for the dark theme */
.dark #custom-cursor {
    background: radial-gradient(circle at 40% 40%, rgba(147, 51, 234, 0.6) 0%, rgba(147, 51, 234, 0.4) 60%, transparent 100%);
    box-shadow: 0 0 16px 4px rgba(147, 51, 234, 0.6), 0 0 0 2px rgba(147, 51, 234, 0.4);
    border: 2px solid #ffffff; /* Use a white border for visibility on dark backgrounds */
}

/* --- Grid Fade at Edges --- */
.grid-fade {
    position: fixed;
    pointer-events: none;
    inset: 0;
    z-index: 0;
    mask-image: radial-gradient(circle at 50% 50%, black 70%, transparent 100%);
    -webkit-mask-image: radial-gradient(circle at 50% 50%, black 70%, transparent 100%);
}

/* --- Grid Light Reflection Effect --- */
#grid-reflection {
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: 1;
    background: radial-gradient(circle at var(--cursor-x, 50%) var(--cursor-y, 50%), rgba(59,130,246,0.12) 0%, rgba(59,130,246,0.08) 20%, transparent 60%);
    transition: background 0.2s;
}
.dark #grid-reflection {
    background: radial-gradient(circle at var(--cursor-x, 50%) var(--cursor-y, 50%), rgba(147,51,234,0.12) 0%, rgba(147,51,234,0.08) 20%, transparent 60%);
}

/* --- Credit Footer --- */
.credit-footer {
    padding: 1rem; /* Add padding to give it some space */
    text-align: center;
    font-size: 0.75rem; /* text-xs */
    color: #6b7280; /* gray-500 */
    transition: color 0.4s ease-in-out;
    width: 100%; /* Ensure it spans the full width */
    margin-top: auto; /* Pushes the footer to the bottom in a flex column container */
}
.dark .credit-footer {
    color: #9ca3af; /* gray-400 */
}
</style>
</head>
<body class="light">
    <!-- Grid Fade Overlay -->
    <div class="grid-fade"></div>
    <!-- Grid Reflection Overlay -->
    <div id="grid-reflection"></div>
    <!-- Custom Cursor -->
    <div id="custom-cursor"></div>
    <!-- Main App Container -->
    <div id="app" class="p-4 md:p-8 flex flex-col items-center justify-start flex-grow relative transition-colors duration-400 ease-in-out">

        <!-- Theme Toggle Button -->
        <button id="theme-toggle" class="absolute top-4 right-4 p-2 rounded-full z-20 focus:outline-none transition-transform duration-300 transform hover:scale-110">
            <svg id="sun-icon" class="h-6 w-6 text-yellow-500 transition-opacity duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
            </svg>
            <svg id="moon-icon" class="h-6 w-6 text-slate-400 transition-opacity duration-300 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
            </svg>
        </button>

        <!-- Search Section (Initial View) -->
        <div id="search-section" class="flex flex-col items-center justify-center flex-grow w-full max-w-2xl px-4 transition-transform duration-500 ease-in-out transform scale-100 opacity-100">
            <div class="hero-typewriter">
                <h1 class="text-5xl md:text-6xl font-bold mb-8 text-center transition-colors duration-300 text-gray-350 dark:text-white">
                    wiki.
                </h1>
            </div>
            <div class="w-full relative">
                <input id="search-input" type="text" placeholder="Search Wikipedia..."
                    class="w-full py-4 px-6 rounded-xl text-lg border-2 focus:outline-none transition-all duration-300 transform focus:scale-[1.02] focus-glow
                    bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-gray-100 border-gray-300 dark:border-gray-700 hover:shadow-lg">
                
                <ul id="search-results" class="absolute top-full left-0 w-full mt-2 rounded-xl shadow-2xl overflow-hidden z-10 hidden vercel-card"></ul>
            </div>
        </div>

        <!-- Article Section (Hidden by default) -->
        <div id="article-section" class="flex flex-col flex-grow w-full max-w-4xl p-4 md:p-8 rounded-2xl shadow-2xl transition-transform duration-500 ease-in-out transform scale-95 opacity-0 hidden vercel-card">
            
            <!-- Article Tools -->
            <div class="flex flex-col md:flex-row justify-between items-center mb-4 space-y-2 md:space-y-0 md:space-x-4">
                <div class="flex items-center space-x-2">
                    <button id="back-button" class="flex items-center text-accent-blue dark:text-blue-400 font-medium transition-transform duration-300 transform hover:-translate-x-1 hover:text-blue-600">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                        </svg>
                        Back to Search
                    </button>
                    <button id="close-button" class="flex items-center text-red-500 dark:text-red-400 font-medium transition-transform duration-300 transform hover:scale-105 hover:text-red-600">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                        Close
                    </button>
                </div>
                
                <div class="flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-4 items-center">
                    
                    <!-- The original select elements are now hidden -->
                    <select id="font-selector" class="hidden">
                        <option value="playfair-poppins">Playfair Display + Poppins</option>
                        <option value="karla-instrument">Karla + Instrument Serif</option>
                        <option value="trispace-alegreya">Trispace + Alegreya Sans</option>
                    </select>

                    <!-- Custom dropdown for Font Family -->
                    <div id="custom-font-selector" class="relative group cursor-pointer py-2 px-4 rounded-full text-sm font-medium border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 transition-colors duration-300">
                        <div class="flex items-center justify-between space-x-2">
                            <span id="font-display">Playfair Display + Poppins</span>
                            <svg class="w-4 h-4 text-gray-500 dark:text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                            </svg>
                        </div>
                        <ul id="font-options" class="absolute top-full left-0 mt-2 w-full rounded-lg shadow-lg bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 z-50 overflow-hidden hidden group-hover:block transition-all duration-300">
                            <li data-value="playfair-poppins" class="font-playfair-poppins p-3 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer text-gray-900 dark:text-gray-100">Playfair Display + Poppins</li>
                            <li data-value="karla-instrument" class="font-karla-instrument p-3 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer text-gray-900 dark:text-gray-100">Karla + Instrument Serif</li>
                            <li data-value="trispace-alegreya" class="font-trispace-alegreya p-3 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer text-gray-900 dark:text-gray-100">Trispace + Alegreya Sans</li>
                        </ul>
                    </div>
                    
                    <select id="font-size-selector" class="hidden">
                        <option value="small">Small</option>
                        <option value="medium" selected>Medium</option>
                        <option value="large">Large</option>
                    </select>

                    <!-- Custom dropdown for Font Size -->
                    <div id="custom-font-size-selector" class="relative group cursor-pointer py-2 px-4 rounded-full text-sm font-medium border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 transition-colors duration-300">
                        <div class="flex items-center justify-between space-x-2">
                            <span id="font-size-display">Medium</span>
                            <svg class="w-4 h-4 text-gray-500 dark:text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                            </svg>
                        </div>
                        <ul id="font-size-options" class="absolute top-full left-0 mt-2 w-full rounded-lg shadow-lg bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 z-50 overflow-hidden hidden group-hover:block transition-all duration-300">
                            <li data-value="small" class="p-3 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer text-gray-900 dark:text-gray-100">Small</li>
                            <li data-value="medium" class="p-3 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer text-gray-900 dark:text-gray-100">Medium</li>
                            <li data-value="large" class="p-3 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer text-gray-900 dark:text-gray-100">Large</li>
                        </ul>
                    </div>
                    
                    <button id="random-button" class="py-2 px-4 rounded-full text-sm font-medium border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 transition-colors duration-300">
                        Random
                    </button>
                    <button id="share-button" class="py-2 px-4 rounded-full text-sm font-medium border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 transition-colors duration-300">
                        Share
                    </button>
                </div>
            </div>

            <div id="article-content" class="text-gray-250 dark:text-gray-100 leading-relaxed wiki-prose">
                <!-- Article content will be inserted here dynamically -->
            </div>
            <div id="loading-indicator" class="flex flex-col items-center justify-center p-8 hidden">
                <div class="animate-spin rounded-full h-12 w-12 border-4 border-accent-blue border-t-transparent mb-4"></div>
                <p>Loading article...</p>
            </div>
        </div>

        <!-- Go to Top Button (Fixed) -->
        <button id="go-to-top-button" class="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />
            </svg>
        </button>
    </div>
    
    <!-- Credit Footer -->
    <footer class="credit-footer">
        Made with ❤️ by arXiVius
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // DOM Elements
            const themeToggle = document.getElementById('theme-toggle');
            const sunIcon = document.getElementById('sun-icon');
            const moonIcon = document.getElementById('moon-icon');
            const searchInput = document.getElementById('search-input');
            const searchResults = document.getElementById('search-results');
            const searchSection = document.getElementById('search-section');
            const articleSection = document.getElementById('article-section');
            const articleContent = document.getElementById('article-content');
            const backButton = document.getElementById('back-button');
            const closeButton = document.getElementById('close-button'); // New Close button
            const loadingIndicator = document.getElementById('loading-indicator');
            const randomButton = document.getElementById('random-button');
            const shareButton = document.getElementById('share-button');
            const goToTopButton = document.getElementById('go-to-top-button');
            
            // Hidden select elements (for functionality)
            const fontSelector = document.getElementById('font-selector');
            const fontSizeSelector = document.getElementById('font-size-selector');
            
            // Custom dropdown elements
            const customFontSelector = document.getElementById('custom-font-selector');
            const fontDisplay = document.getElementById('font-display');
            const fontOptions = document.getElementById('font-options');

            const customFontSizeSelector = document.getElementById('custom-font-size-selector');
            const fontSizeDisplay = document.getElementById('font-size-display');
            const fontSizeOptions = document.getElementById('font-size-options');
            
            const body = document.body;
            const html = document.documentElement;

            // --- Initial State Setup ---

            // Set initial theme based on user preference or default
            const savedTheme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
                html.classList.add('dark');
                body.classList.remove('light');
                body.classList.add('dark');
                sunIcon.classList.add('hidden');
                moonIcon.classList.remove('hidden');
            } else {
                html.classList.remove('dark');
                body.classList.remove('dark');
                body.classList.add('light');
                sunIcon.classList.remove('hidden');
                moonIcon.classList.add('hidden');
            }

            // Set initial font preference from localStorage
            const savedFont = localStorage.getItem('fontPreference');
            if (savedFont) {
                body.classList.add(`font-${savedFont}`);
                fontSelector.value = savedFont;
                // Update the custom display
                fontDisplay.textContent = fontOptions.querySelector(`[data-value="${savedFont}"]`).textContent;
            }

            // Set initial font size preference from localStorage
            const savedFontSize = localStorage.getItem('fontSizePreference');
            if (savedFontSize) {
                body.classList.add(`font-size-${savedFontSize}`);
                fontSizeSelector.value = savedFontSize;
                // Update the custom display
                fontSizeDisplay.textContent = fontSizeOptions.querySelector(`[data-value="${savedFontSize}"]`).textContent;
            }

            // --- Theme and Font Functionality ---

            // Theme toggle functionality
            themeToggle.addEventListener('click', () => {
                const isDarkMode = html.classList.toggle('dark');
                if (isDarkMode) {
                    body.classList.remove('light');
                    body.classList.add('dark');
                } else {
                    body.classList.remove('dark');
                    body.classList.add('light');
                }
                localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
                sunIcon.classList.toggle('hidden', isDarkMode);
                moonIcon.classList.toggle('hidden', !isDarkMode);
            });

            // Handle Font family change
            const handleFontChange = (selectedFont) => {
                body.classList.remove('font-karla-instrument', 'font-trispace-alegreya');
                if (selectedFont !== 'playfair-poppins') {
                    body.classList.add(`font-${selectedFont}`);
                }
                localStorage.setItem('fontPreference', selectedFont);
            };

            // Handle Font size change
            const handleFontSizeChange = (selectedSize) => {
                body.classList.remove('font-size-small', 'font-size-large');
                if (selectedSize !== 'medium') {
                    body.classList.add(`font-size-${selectedSize}`);
                }
                localStorage.setItem('fontSizePreference', selectedSize);
            };

            // Font family selector functionality
            fontSelector.addEventListener('change', (event) => {
                handleFontChange(event.target.value);
            });

            // Font size selector functionality
            fontSizeSelector.addEventListener('change', (event) => {
                handleFontSizeChange(event.target.value);
            });
            
            // --- Custom Dropdown Logic ---
            const setupCustomDropdown = (customSelector, hiddenSelector, displayElement, optionsElement) => {
                optionsElement.addEventListener('click', (e) => {
                    const selectedLi = e.target.closest('li');
                    if (selectedLi) {
                        const value = selectedLi.dataset.value;
                        const text = selectedLi.textContent;
                        
                        // Update the hidden select value and dispatch a change event
                        hiddenSelector.value = value;
                        hiddenSelector.dispatchEvent(new Event('change'));

                        // Update the custom display text
                        displayElement.textContent = text;
                        
                        // Hide the options list
                        optionsElement.classList.add('hidden');
                    }
                });

                customSelector.addEventListener('click', (e) => {
                    e.stopPropagation(); // Prevent document click from closing it immediately
                    optionsElement.classList.toggle('hidden');
                });

                document.addEventListener('click', (e) => {
                    if (!customSelector.contains(e.target)) {
                        optionsElement.classList.add('hidden');
                    }
                });
            };

            // Initialize custom dropdowns
            setupCustomDropdown(customFontSelector, fontSelector, fontDisplay, fontOptions);
            setupCustomDropdown(customFontSizeSelector, fontSizeSelector, fontSizeDisplay, fontSizeOptions);

            // --- API and UI Logic ---

            // State management for API call
            let debounceTimer;

            /**
             * Debounces the search input to avoid excessive API calls.
             * @param {Function} func The function to debounce.
             * @param {number} delay The debounce delay in milliseconds.
             */
            const debounce = (func, delay) => {
                clearTimeout(debounceTimer);
                debounceTimer = setTimeout(func, delay);
            };

            /**
             * Fetches search suggestions from the Wikipedia API.
             * @param {string} query The search query.
             */
            const fetchSuggestions = async (query) => {
                if (query.trim() === '') {
                    searchResults.innerHTML = '';
                    searchResults.classList.add('hidden');
                    return;
                }

                try {
                    const response = await fetch(`https://en.wikipedia.org/w/api.php?action=opensearch&limit=10&namespace=0&format=json&origin=*&search=${encodeURIComponent(query)}`);
                    if (!response.ok) throw new Error('Network response was not ok');
                    const data = await response.json();
                    renderSuggestions(data[1]);
                } catch (error) {
                    console.error('Failed to fetch search suggestions:', error);
                    searchResults.innerHTML = `<li class="p-4 text-red-500">Error fetching results. Please try again.</li>`;
                    searchResults.classList.remove('hidden');
                }
            };

            /**
             * Renders the search suggestions in the UI.
             * @param {string[]} suggestions An array of search result titles.
             */
            const renderSuggestions = (suggestions) => {
                searchResults.innerHTML = '';
                if (suggestions.length === 0) {
                    searchResults.innerHTML = `<li class="p-4 text-gray-500">No results found.</li>`;
                    searchResults.classList.remove('hidden');
                    return;
                }
                suggestions.forEach(title => {
                    const li = document.createElement('li');
                    li.textContent = title;
                    li.className = 'p-4 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-200';
                    li.addEventListener('click', () => {
                        fetchArticle(title);
                        searchResults.classList.add('hidden');
                        searchInput.value = title;
                    });
                    searchResults.appendChild(li);
                });
                searchResults.classList.remove('hidden');
            };

            /**
             * Fetches and displays a full Wikipedia article.
             * @param {string} title The title of the article to fetch.
             */
            const fetchArticle = async (title) => {
                // Animate out search section and show loading
                searchSection.classList.remove('scale-100', 'opacity-100');
                searchSection.classList.add('scale-95', 'opacity-0');
                
                // Hide search section after its transition is complete
                setTimeout(() => {
                    searchSection.classList.add('hidden');
                    loadingIndicator.classList.remove('hidden');
                    articleSection.classList.remove('hidden'); // Show article section
                    articleSection.classList.remove('scale-95', 'opacity-0');
                    articleSection.classList.add('scale-100', 'opacity-100');
                    articleContent.innerHTML = '';
                }, 500); // Duration matches the CSS transition

                try {
                    const response = await fetch(`https://en.wikipedia.org/w/api.php?action=parse&format=json&origin=*&page=${encodeURIComponent(title)}`);
                    if (!response.ok) throw new Error('Network response was not ok');
                    const data = await response.json();
                    
                    loadingIndicator.classList.add('hidden');
                    if (data.error) {
                        articleContent.innerHTML = `<h2 class="text-3xl font-bold mb-4">Error</h2><p>Article not found. Please try a different search term.</p>`;
                    } else if (data.parse && data.parse.text) {
                        renderArticle(data.parse.title, data.parse.text['*']);
                    } else {
                        articleContent.innerHTML = `<h2 class="text-3xl font-bold mb-4">Article not found</h2><p>Sorry, the article for "${title}" could not be found.</p>`;
                    }
                } catch (error) {
                    loadingIndicator.classList.add('hidden');
                    console.error('Failed to fetch article:', error);
                    articleContent.innerHTML = `<h2 class="text-3xl font-bold mb-4">Error</h2><p>There was an error loading the article. Please try again.</p>`;
                }
            };

            /**
             * Renders the article content and cleans up the HTML.
             * @param {string} title The article title.
             * @param {string} htmlContent The raw HTML content from the API.
             */
            const renderArticle = (title, htmlContent) => {
                // Create a temporary element to parse the HTML
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = htmlContent;

                // Remove unwanted elements like edit sections, citations, etc.
                const unwantedSelectors = [
                    '.mw-editsection',
                    'sup.reference',
                    '.citation',
                    '#toc',
                    '.reflist',
                    '#References',
                    '#See_also',
                    '#External_links',
                    '#Notes',
                    '#Further_reading',
                    '.mw-parser-output .reference',
                    '#Notes_and_references'
                ];
                unwantedSelectors.forEach(selector => {
                    tempDiv.querySelectorAll(selector).forEach(el => el.remove());
                });

                // Set the cleaned HTML to the article content area
                articleContent.innerHTML = `<h2 class="text-3xl md:text-4xl font-bold mb-6">${title}</h2>` + tempDiv.innerHTML;

                // Handle internal and external links
                articleContent.querySelectorAll('a').forEach(link => {
                    const href = link.getAttribute('href');
                    if (href && href.startsWith('/wiki/')) {
                        // For internal Wikipedia links, prevent default behavior and fetch the new article
                        link.addEventListener('click', (e) => {
                            e.preventDefault();
                            const newTitle = decodeURIComponent(href.replace('/wiki/', ''));
                            fetchArticle(newTitle);
                        });
                    } else {
                        // For other links, ensure they open in a new tab
                        link.target = '_blank';
                        link.rel = 'noopener noreferrer';
                    }
                });
            };

            /**
             * Fetches a random article.
             */
            const fetchRandomArticle = async () => {
                try {
                    const response = await fetch(`https://en.wikipedia.org/w/api.php?action=query&list=random&rnlimit=1&format=json&origin=*`);
                    const data = await response.json();
                    if (data.query && data.query.random && data.query.random.length > 0) {
                        const title = data.query.random[0].title;
                        fetchArticle(title);
                    } else {
                         // Fallback behavior if random article cannot be fetched
                         console.error("Failed to fetch a random article.");
                         articleContent.innerHTML = `<h2 class="text-3xl font-bold mb-4">Error</h2><p>Could not load a random article. Please try again.</p>`;
                    }
                } catch (error) {
                    console.error("Failed to fetch random article:", error);
                    articleContent.innerHTML = `<h2 class="text-3xl font-bold mb-4">Error</h2><p>There was an error loading the random article. Please try again.</p>`;
                }
            };
            
            /**
             * Handles sharing the current article's URL.
             */
            const shareArticle = () => {
                const articleTitle = articleContent.querySelector('h2')?.textContent || 'Wikipedia Article';
                const url = `https://en.wikipedia.org/wiki/${encodeURIComponent(articleTitle)}`;
                
                if (navigator.share) {
                    navigator.share({
                        title: articleTitle,
                        url: url
                    }).catch(console.error);
                } else {
                    // Fallback for browsers that don't support the Web Share API
                    const tempInput = document.createElement('input');
                    document.body.appendChild(tempInput);
                    tempInput.value = url;
                    tempInput.select();
                    document.execCommand('copy');
                    document.body.removeChild(tempInput);
                    // Provide visual feedback
                    // NOTE: This is the alert you might see on some environments. We should replace this with a custom modal in the future.
                    alert('Link copied to clipboard!');
                }
            };

            // Common function to reset to the search screen
            const resetToSearch = () => {
                articleSection.classList.remove('scale-100', 'opacity-100');
                articleSection.classList.add('scale-95', 'opacity-0');
                
                setTimeout(() => {
                    // Hide the article section completely after its transition is over
                    articleSection.classList.add('hidden');
                    
                    searchSection.classList.remove('hidden', 'scale-95', 'opacity-0');
                    searchSection.classList.add('scale-100', 'opacity-100');
                    searchInput.value = ''; // Clear search input on back/close
                    window.scrollTo(0, 0); // Scroll to the top of the page
                }, 500);
            }

            // Event Listeners
            searchInput.addEventListener('input', (e) => {
                const query = e.target.value;
                debounce(() => fetchSuggestions(query), 300);
            });
            
            // Listen for the "Enter" key press on the search input
            searchInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    // Prevent default form submission
                    e.preventDefault();
                    const query = searchInput.value;
                    // Check if the query is not empty before searching
                    if (query.trim() !== '') {
                        fetchArticle(query);
                        // Hide the suggestions dropdown
                        searchResults.classList.add('hidden');
                    }
                }
            });

            // Hide results when clicking outside
            document.addEventListener('click', (e) => {
                if (!searchResults.contains(e.target) && e.target !== searchInput) {
                    searchResults.classList.add('hidden');
                }
            });

            backButton.addEventListener('click', resetToSearch);
            closeButton.addEventListener('click', resetToSearch);
            
            randomButton.addEventListener('click', fetchRandomArticle);
            shareButton.addEventListener('click', shareArticle);
            
            // Go to Top button visibility
            window.addEventListener('scroll', () => {
                if (window.scrollY > 200) {
                    goToTopButton.classList.remove('hidden');
                    goToTopButton.classList.add('visible');
                } else {
                    goToTopButton.classList.remove('visible');
                    goToTopButton.classList.add('hidden');
                }
            });

            // Go to Top button click handler
            goToTopButton.addEventListener('click', () => {
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            });

            // --- Custom Cursor Logic ---
            const customCursor = document.getElementById('custom-cursor');
            document.addEventListener('mousemove', (e) => {
                let x = e.clientX;
                let y = e.clientY;
                // Center the cursor
                customCursor.style.transform = `translate(${x - 16}px, ${y - 16}px)`;
            });
            
            // --- Grid reacts to cursor (light reflection) ---
            const gridReflection = document.getElementById('grid-reflection');
            document.addEventListener('mousemove', (e) => {
                const x = (e.clientX / window.innerWidth) * 100;
                const y = (e.clientY / window.innerHeight) * 100;
                gridReflection.style.setProperty('--cursor-x', `${x}%`);
                gridReflection.style.setProperty('--cursor-y', `${y}%`);
            });
        });
    </script>
</body>
</html>
